import{Q as j,ab as Ee,b as de,b0 as Te,U as M,c as b,z as Ve,X as G,_ as ie,d as H,u as ue,G as fe,a as he,W as pe,bd as R,Z as Ae,m as E,o as y,g as v,i as W,q as V,w as $,p as x,t as B,h as e,aM as X,n as T,e as Y,f as ee,be as Pe,v as te,F as O,aD as F,j as K,r as Z,Y as De,bb as le,bf as $e,E as ae,bg as Ne,ae as se,b7 as Be,y as Le,aL as Q,K as Me,aK as ge}from"./index-Dv6_wpbJ.js";import{b as Se,E as ne,l as ve,m as me,f as re,g as Ue,j as Oe,h as Fe}from"./EditStore-Bu9gI-u2.js";import{E as Re}from"./input-B9sYFckQ.js";import{U as ye,C as Ce,m as oe,n as He}from"./drawer-Cod10NLr.js";import{_ as qe}from"./WavesBar-BOheqx-y.js";const ke="left-check-change",be="right-check-change",q=de({data:{type:M(Array),default:()=>[]},titles:{type:M(Array),default:()=>[]},buttonTexts:{type:M(Array),default:()=>[]},filterPlaceholder:String,filterMethod:{type:M(Function)},leftDefaultChecked:{type:M(Array),default:()=>[]},rightDefaultChecked:{type:M(Array),default:()=>[]},renderContent:{type:M(Function)},modelValue:{type:M(Array),default:()=>[]},format:{type:M(Object),default:()=>({})},filterable:Boolean,props:{type:M(Object),default:()=>Te({label:"label",key:"key",disabled:"disabled"})},targetOrder:{type:String,values:["original","push","unshift"],default:"original"},validateEvent:{type:Boolean,default:!0}}),J=(a,n)=>[a,n].every(j)||j(a)&&Ee(n),Ke={[Ce]:(a,n,g)=>[a,g].every(j)&&["left","right"].includes(n),[ye]:a=>j(a),[ke]:J,[be]:J},I="checked-change",we=de({data:q.data,optionRender:{type:M(Function)},placeholder:String,title:String,filterable:Boolean,format:q.format,filterMethod:q.filterMethod,defaultChecked:q.leftDefaultChecked,props:q.props}),Ge={[I]:J},z=a=>{const n={label:"label",key:"key",disabled:"disabled"};return b(()=>({...n,...a.props}))},ze=(a,n,g)=>{const o=z(a),u=b(()=>a.data.filter(r=>Ve(a.filterMethod)?a.filterMethod(n.query,r):String(r[o.value.label]||r[o.value.key]).toLowerCase().includes(n.query.toLowerCase()))),c=b(()=>u.value.filter(r=>!r[o.value.disabled])),h=b(()=>{const r=n.checked.length,m=a.data.length,{noChecked:C,hasChecked:A}=a.format;return C&&A?r>0?A.replace(/\${checked}/g,r.toString()).replace(/\${total}/g,m.toString()):C.replace(/\${total}/g,m.toString()):`${r}/${m}`}),l=b(()=>{const r=n.checked.length;return r>0&&r<c.value.length}),p=()=>{const r=c.value.map(m=>m[o.value.key]);n.allChecked=r.length>0&&r.every(m=>n.checked.includes(m))},f=r=>{n.checked=r?c.value.map(m=>m[o.value.key]):[]};return G(()=>n.checked,(r,m)=>{if(p(),n.checkChangeByUser){const C=r.concat(m).filter(A=>!r.includes(A)||!m.includes(A));g(I,r,C)}else g(I,r),n.checkChangeByUser=!0}),G(c,()=>{p()}),G(()=>a.data,()=>{const r=[],m=u.value.map(C=>C[o.value.key]);n.checked.forEach(C=>{m.includes(C)&&r.push(C)}),n.checkChangeByUser=!1,n.checked=r}),G(()=>a.defaultChecked,(r,m)=>{if(m&&r.length===m.length&&r.every(N=>m.includes(N)))return;const C=[],A=c.value.map(N=>N[o.value.key]);r.forEach(N=>{A.includes(N)&&C.push(N)}),n.checkChangeByUser=!1,n.checked=C},{immediate:!0}),{filteredData:u,checkableData:c,checkedSummary:h,isIndeterminate:l,updateAllChecked:p,handleAllCheckedChange:f}},je=H({name:"ElTransferPanel"}),We=H({...je,props:we,emits:Ge,setup(a,{expose:n,emit:g}){const o=a,u=ue(),c=({option:k})=>k,{t:h}=fe(),l=he("transfer"),p=pe({checked:[],allChecked:!1,query:"",checkChangeByUser:!0}),f=z(o),{filteredData:r,checkedSummary:m,isIndeterminate:C,handleAllCheckedChange:A}=ze(o,p,g),N=b(()=>!R(p.query)&&R(r.value)),P=b(()=>!R(u.default()[0].children)),{checked:t,allChecked:s,query:d}=Ae(p);return n({query:d}),(k,L)=>(y(),E("div",{class:T(e(l).b("panel"))},[v("p",{class:T(e(l).be("panel","header"))},[V(e(oe),{modelValue:e(s),"onUpdate:modelValue":_=>X(s)?s.value=_:null,indeterminate:e(C),"validate-event":!1,onChange:e(A)},{default:$(()=>[x(B(k.title)+" ",1),v("span",null,B(e(m)),1)]),_:1},8,["modelValue","onUpdate:modelValue","indeterminate","onChange"])],2),v("div",{class:T([e(l).be("panel","body"),e(l).is("with-footer",e(P))])},[k.filterable?(y(),Y(e(Re),{key:0,modelValue:e(d),"onUpdate:modelValue":_=>X(d)?d.value=_:null,class:T(e(l).be("panel","filter")),size:"default",placeholder:k.placeholder,"prefix-icon":e(Pe),clearable:"","validate-event":!1},null,8,["modelValue","onUpdate:modelValue","class","placeholder","prefix-icon"])):W("v-if",!0),ee(V(e(He),{modelValue:e(t),"onUpdate:modelValue":_=>X(t)?t.value=_:null,"validate-event":!1,class:T([e(l).is("filterable",k.filterable),e(l).be("panel","list")])},{default:$(()=>[(y(!0),E(O,null,F(e(r),_=>(y(),Y(e(oe),{key:_[e(f).key],class:T(e(l).be("panel","item")),value:_[e(f).key],disabled:_[e(f).disabled],"validate-event":!1},{default:$(()=>{var D;return[V(c,{option:(D=k.optionRender)==null?void 0:D.call(k,_)},null,8,["option"])]}),_:2},1032,["class","value","disabled"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","class"]),[[te,!e(N)&&!e(R)(k.data)]]),ee(v("div",{class:T(e(l).be("panel","empty"))},[K(k.$slots,"empty",{},()=>[x(B(e(N)?e(h)("el.transfer.noMatch"):e(h)("el.transfer.noData")),1)])],2),[[te,e(N)||e(R)(k.data)]])],2),e(P)?(y(),E("p",{key:0,class:T(e(l).be("panel","footer"))},[K(k.$slots,"default")],2)):W("v-if",!0)],2))}});var ce=ie(We,[["__file","transfer-panel.vue"]]);const Qe=a=>{const n=z(a),g=b(()=>a.data.reduce((c,h)=>(c[h[n.value.key]]=h)&&c,{})),o=b(()=>a.data.filter(c=>!a.modelValue.includes(c[n.value.key]))),u=b(()=>a.targetOrder==="original"?a.data.filter(c=>a.modelValue.includes(c[n.value.key])):a.modelValue.reduce((c,h)=>{const l=g.value[h];return l&&c.push(l),c},[]));return{sourceData:o,targetData:u}},Xe=(a,n,g)=>{const o=z(a),u=(l,p,f)=>{g(ye,l),g(Ce,l,p,f)};return{addToLeft:()=>{const l=a.modelValue.slice();n.rightChecked.forEach(p=>{const f=l.indexOf(p);f>-1&&l.splice(f,1)}),u(l,"left",n.rightChecked)},addToRight:()=>{let l=a.modelValue.slice();const p=a.data.filter(f=>{const r=f[o.value.key];return n.leftChecked.includes(r)&&!a.modelValue.includes(r)}).map(f=>f[o.value.key]);l=a.targetOrder==="unshift"?p.concat(l):l.concat(p),a.targetOrder==="original"&&(l=a.data.filter(f=>l.includes(f[o.value.key])).map(f=>f[o.value.key])),u(l,"right",n.leftChecked)}}},Ye=(a,n)=>({onSourceCheckedChange:(u,c)=>{a.leftChecked=u,c&&n(ke,u,c)},onTargetCheckedChange:(u,c)=>{a.rightChecked=u,c&&n(be,u,c)}}),Ze=H({name:"ElTransfer"}),Je=H({...Ze,props:q,emits:Ke,setup(a,{expose:n,emit:g}){const o=a,u=ue(),{t:c}=fe(),h=he("transfer"),{formItem:l}=Se(),p=pe({leftChecked:[],rightChecked:[]}),f=z(o),{sourceData:r,targetData:m}=Qe(o),{onSourceCheckedChange:C,onTargetCheckedChange:A}=Ye(p,g),{addToLeft:N,addToRight:P}=Xe(o,p,g),t=Z(),s=Z(),d=i=>{switch(i){case"left":t.value.query="";break;case"right":s.value.query="";break}},k=b(()=>o.buttonTexts.length===2),L=b(()=>o.titles[0]||c("el.transfer.titles.0")),_=b(()=>o.titles[1]||c("el.transfer.titles.1")),D=b(()=>o.filterPlaceholder||c("el.transfer.filterPlaceholder"));G(()=>o.modelValue,()=>{var i;o.validateEvent&&((i=l==null?void 0:l.validate)==null||i.call(l,"change").catch(U=>De()))});const S=b(()=>i=>{var U;if(o.renderContent)return o.renderContent(le,i);const w=(((U=u.default)==null?void 0:U.call(u,{option:i}))||[]).filter(_e=>_e.type!==$e);return w.length?w:le("span",i[f.value.label]||i[f.value.key])});return n({clearQuery:d,leftPanel:t,rightPanel:s}),(i,U)=>(y(),E("div",{class:T(e(h).b())},[V(ce,{ref_key:"leftPanel",ref:t,data:e(r),"option-render":e(S),placeholder:e(D),title:e(L),filterable:i.filterable,format:i.format,"filter-method":i.filterMethod,"default-checked":i.leftDefaultChecked,props:o.props,onCheckedChange:e(C)},{empty:$(()=>[K(i.$slots,"left-empty")]),default:$(()=>[K(i.$slots,"left-footer")]),_:3},8,["data","option-render","placeholder","title","filterable","format","filter-method","default-checked","props","onCheckedChange"]),v("div",{class:T(e(h).e("buttons"))},[V(e(ne),{type:"primary",class:T([e(h).e("button"),e(h).is("with-texts",e(k))]),disabled:e(R)(p.rightChecked),onClick:e(N)},{default:$(()=>[V(e(ae),null,{default:$(()=>[V(e(Ne))]),_:1}),e(se)(i.buttonTexts[0])?W("v-if",!0):(y(),E("span",{key:0},B(i.buttonTexts[0]),1))]),_:1},8,["class","disabled","onClick"]),V(e(ne),{type:"primary",class:T([e(h).e("button"),e(h).is("with-texts",e(k))]),disabled:e(R)(p.leftChecked),onClick:e(P)},{default:$(()=>[e(se)(i.buttonTexts[1])?W("v-if",!0):(y(),E("span",{key:0},B(i.buttonTexts[1]),1)),V(e(ae),null,{default:$(()=>[V(e(Be))]),_:1})]),_:1},8,["class","disabled","onClick"])],2),V(ce,{ref_key:"rightPanel",ref:s,data:e(m),"option-render":e(S),placeholder:e(D),filterable:i.filterable,format:i.format,"filter-method":i.filterMethod,title:e(_),"default-checked":i.rightDefaultChecked,props:o.props,onCheckedChange:e(A)},{empty:$(()=>[K(i.$slots,"right-empty")]),default:$(()=>[K(i.$slots,"right-footer")]),_:3},8,["data","option-render","placeholder","filterable","format","filter-method","title","default-checked","props","onCheckedChange"])],2))}});var Ie=ie(Je,[["__file","transfer.vue"]]);const xe=Le(Ie),et=H({__name:"SelectPlayers",setup(a){const n=ve(),{players:g}=Q(n),o=b(()=>g.value.map(h=>({key:h.id,label:`${h.id}`,disabled:!1}))),u=Z(g.value.filter(h=>h.absent).map(h=>h.id));function c(h,l,p){for(const f of g.value)p.includes(f.id)&&(f.absent=l==="right");g.value.sort((f,r)=>Number(f.absent)-Number(r.absent))}return(h,l)=>{const p=xe;return y(),Y(p,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=f=>u.value=f),data:o.value,titles:["忠诚","鸽子"],onChange:c},null,8,["modelValue","data"])}}}),tt={class:"grid-container"},lt={class:"grid-row"},at=["onClick"],st={class:"grid-row"},nt={class:"grid-row"},rt={class:"grid-row"},ot=H({__name:"PlayersCube",setup(a){const n=ve(),g=me(),o=["#e0e0e0","#409EFF","#67C23A"],{waves:u,cube:c,lock:h}=Q(g),{players:l}=Q(n),p=b(()=>{var D;const P=(u==null?void 0:u.value.length)??0,t=(l==null?void 0:l.value.length)??0,s=Array(P).fill(0),d=Array(P).fill(0),k=Array(t).fill(0),L=Array(t).fill(0);for(let S=0;S<P;S++)for(let i=0;i<t;i++){const U=l.value[i],w=(D=c.value[U.id])==null?void 0:D[S];w===1&&!U.absent?(s[S]++,k[i]++):w===2&&!U.absent&&(d[S]++,L[i]++)}const _=s.map((S,i)=>12-S-d[i]);return{outputCounts:s,supportCounts:d,emptyCounts:_,playerOutputCounts:k,playerSupportCounts:L}}),f=b(()=>p.value.outputCounts),r=b(()=>p.value.supportCounts),m=b(()=>p.value.emptyCounts),C=b(()=>l.value.map((P,t)=>{var s;return(P.carry??0)-(((s=p.value.playerOutputCounts)==null?void 0:s[t])??0)})),A=b(()=>l.value.map((P,t)=>{var s;return(P.sup??0)-(((s=p.value.playerSupportCounts)==null?void 0:s[t])??0)}));function N(P,t,s){const d=l.value[P];if(d.absent){re({message:"鸽子不受影响",type:"warning",duration:2e3});return}else if(s){re({message:"数据已锁定",type:"warning",duration:2e3});return}const k=m.value[t],L=C.value[P],_=A.value[P],D=c.value[d.id][t];k===0&&D===0?alert(`第 ${t+1} 波人满为患！`):L+_===0&&D===0?alert(`${d.id} 角色不足！`):L===0&&_!==0&&D===0?g.changeCubeState(d.id,t,2):L!==0&&_===0&&D===0?g.changeCubeState(d.id,t,1):D===1?_>0?g.changeCubeState(d.id,t,1):g.changeCubeState(d.id,t,2):D===2||L>0?g.changeCubeState(d.id,t,1):_>0&&g.changeCubeState(d.id,t,2)}return(P,t)=>(y(),E("div",tt,[v("div",lt,[t[0]||(t[0]=v("div",{class:"grid-cell header-cell empty-header"},null,-1)),(y(!0),E(O,null,F(e(u).length,s=>(y(),E("div",{key:"header-"+s,class:T(["grid-cell header-cell header-columns",{hard:e(u)[s-1].difficulty==="Hard"}])},B(e(u)[s-1].difficulty)+" "+B(s),3))),128)),t[1]||(t[1]=v("div",{class:"grid-cell header-cell info-head"}," 余C ",-1)),t[2]||(t[2]=v("div",{class:"grid-cell header-cell info-head"}," 余奶 ",-1)),t[3]||(t[3]=v("div",{class:"grid-cell header-cell info-head"}," 余人 ",-1))]),(y(!0),E(O,null,F(e(l),(s,d)=>(y(),E("div",{key:d,class:"grid-row"},[v("div",{class:T(["grid-cell header-cell",s.absent?"absent":"header-index"])},B((s==null?void 0:s.id)||"未知玩家"),3),(y(!0),E(O,null,F(e(c)[s.id],(k,L)=>(y(),E("div",{key:L,class:T(["grid-cell",{absent:s.absent}]),style:Me({backgroundColor:o[k]}),onClick:_=>N(d,L,e(h))},null,14,at))),128)),v("div",{class:T(["grid-cell stat-cell",s.absent?"absent":"carry"])},B(C.value[d]),3),v("div",{class:T(["grid-cell stat-cell",s.absent?"absent":"support"])},B(A.value[d]),3),v("div",{class:T(["grid-cell stat-cell",{absent:s.absent,left:C.value[d]+A.value[d]!==0&&!e(l)[d].absent,zeroleft:C.value[d]+A.value[d]===0&&!e(l)[d].absent}])},B(C.value[d]+A.value[d]),3)]))),128)),v("div",st,[t[4]||(t[4]=v("div",{class:"grid-cell header-cell info-head"},"输出",-1)),(y(!0),E(O,null,F(e(u).length,s=>(y(),E("div",{key:"stat1-"+s,class:"grid-cell stat-cell carry"},B(f.value[s-1]),1))),128)),t[5]||(t[5]=v("div",{class:"grid-cell stat-cell"},null,-1)),t[6]||(t[6]=v("div",{class:"grid-cell stat-cell"},null,-1)),t[7]||(t[7]=v("div",{class:"grid-cell stat-cell"},null,-1))]),v("div",nt,[t[8]||(t[8]=v("div",{class:"grid-cell header-cell info-head"},"辅助",-1)),(y(!0),E(O,null,F(e(u).length,s=>(y(),E("div",{key:"stat2-"+s,class:"grid-cell stat-cell support"},B(r.value[s-1]),1))),128)),t[9]||(t[9]=v("div",{class:"grid-cell stat-cell"},null,-1)),t[10]||(t[10]=v("div",{class:"grid-cell stat-cell"},null,-1)),t[11]||(t[11]=v("div",{class:"grid-cell stat-cell"},null,-1))]),v("div",rt,[t[12]||(t[12]=v("div",{class:"grid-cell header-cell info-head"},"空位",-1)),(y(!0),E(O,null,F(e(u).length,s=>(y(),E("div",{key:"stat3-"+s,class:T(["grid-cell stat-cell",{left:m.value[s-1]!==0,zeroleft:m.value[s-1]===0}])},B(m.value[s-1]),3))),128)),t[13]||(t[13]=v("div",{class:"grid-cell stat-cell"},null,-1)),t[14]||(t[14]=v("div",{class:"grid-cell stat-cell"},null,-1)),t[15]||(t[15]=v("div",{class:"grid-cell stat-cell"},null,-1))])]))}}),ct=ge(ot,[["__scopeId","data-v-32c1b749"]]),dt={class:"common-layout"},it=H({__name:"TeamOverview",setup(a){const n=me(),{lock:g}=Q(n);return(o,u)=>{const c=qe,h=Ue,l=ct,p=Oe,f=et,r=Fe;return y(),E("div",dt,[V(r,{class:"container"},{default:$(()=>[V(h,{class:"aside-left"},{default:$(()=>[V(c)]),_:1}),V(p,{class:"main-content"},{default:$(()=>[V(l)]),_:1}),V(h,{class:"aside-right"},{default:$(()=>[V(f)]),_:1})]),_:1})])}}}),vt=ge(it,[["__scopeId","data-v-255a0e01"]]);export{vt as default};
