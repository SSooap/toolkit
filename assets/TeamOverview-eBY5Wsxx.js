import{a2 as Q,aX as Te,e as ie,bo as Ve,a3 as S,g as E,a0 as Ae,H as K,_ as fe,j as F,aK as he,X as pe,k as me,F as ve,$ as w,G as Pe,l as C,o as g,m as T,N as z,P as k,Q as P,x as ee,y as N,n as e,s as Y,q as $,O as X,w as te,by as $e,ah as ae,R as M,W as O,t as q,r as J,I as De,L as le,bz as Ne,V as se,bA as Le,a1 as ne,S as Re,J as Se,bb as j,A as re,ba as ge}from"./index-18NlCW2a.js";import{c as Ue,E as oe,j as x,k as ye,e as ce,f as Be,g as Me,h as Oe}from"./WaveStore-BQ0GHCTp.js";import{E as Fe}from"./input-CsFgNtiq.js";import{U as Ce,C as ke,E as de,e as we}from"./scrollbar-WruQo-5C.js";import{E as He,a as qe,b as Ge,c as Ke}from"./table-column-7BzWnrwy.js";const be="left-check-change",_e="right-check-change",H=ie({data:{type:S(Array),default:()=>[]},titles:{type:S(Array),default:()=>[]},buttonTexts:{type:S(Array),default:()=>[]},filterPlaceholder:String,filterMethod:{type:S(Function)},leftDefaultChecked:{type:S(Array),default:()=>[]},rightDefaultChecked:{type:S(Array),default:()=>[]},renderContent:{type:S(Function)},modelValue:{type:S(Array),default:()=>[]},format:{type:S(Object),default:()=>({})},filterable:Boolean,props:{type:S(Object),default:()=>Ve({label:"label",key:"key",disabled:"disabled"})},targetOrder:{type:String,values:["original","push","unshift"],default:"original"},validateEvent:{type:Boolean,default:!0}}),Z=(a,l)=>[a,l].every(Q)||Q(a)&&Te(l),ze={[ke]:(a,l,v)=>[a,v].every(Q)&&["left","right"].includes(l),[Ce]:a=>Q(a),[be]:Z,[_e]:Z},I="checked-change",je=ie({data:H.data,optionRender:{type:S(Function)},placeholder:String,title:String,filterable:Boolean,format:H.format,filterMethod:H.filterMethod,defaultChecked:H.leftDefaultChecked,props:H.props}),We={[I]:Z},W=a=>{const l={label:"label",key:"key",disabled:"disabled"};return E(()=>({...l,...a.props}))},Qe=(a,l,v)=>{const c=W(a),u=E(()=>a.data.filter(s=>Ae(a.filterMethod)?a.filterMethod(l.query,s):String(s[c.value.label]||s[c.value.key]).toLowerCase().includes(l.query.toLowerCase()))),r=E(()=>u.value.filter(s=>!s[c.value.disabled])),h=E(()=>{const s=l.checked.length,p=a.data.length,{noChecked:y,hasChecked:V}=a.format;return y&&V?s>0?V.replace(/\${checked}/g,s.toString()).replace(/\${total}/g,p.toString()):y.replace(/\${total}/g,p.toString()):`${s}/${p}`}),t=E(()=>{const s=l.checked.length;return s>0&&s<r.value.length}),d=()=>{const s=r.value.map(p=>p[c.value.key]);l.allChecked=s.length>0&&s.every(p=>l.checked.includes(p))},o=s=>{l.checked=s?r.value.map(p=>p[c.value.key]):[]};return K(()=>l.checked,(s,p)=>{if(d(),l.checkChangeByUser){const y=s.concat(p).filter(V=>!s.includes(V)||!p.includes(V));v(I,s,y)}else v(I,s),l.checkChangeByUser=!0}),K(r,()=>{d()}),K(()=>a.data,()=>{const s=[],p=u.value.map(y=>y[c.value.key]);l.checked.forEach(y=>{p.includes(y)&&s.push(y)}),l.checkChangeByUser=!1,l.checked=s}),K(()=>a.defaultChecked,(s,p)=>{if(p&&s.length===p.length&&s.every(b=>p.includes(b)))return;const y=[],V=r.value.map(b=>b[c.value.key]);s.forEach(b=>{V.includes(b)&&y.push(b)}),l.checkChangeByUser=!1,l.checked=y},{immediate:!0}),{filteredData:u,checkableData:r,checkedSummary:h,isIndeterminate:t,updateAllChecked:d,handleAllCheckedChange:o}},Xe=F({name:"ElTransferPanel"}),Je=F({...Xe,props:je,emits:We,setup(a,{expose:l,emit:v}){const c=a,u=he(),r=({option:_})=>_,{t:h}=pe(),t=me("transfer"),d=ve({checked:[],allChecked:!1,query:"",checkChangeByUser:!0}),o=W(c),{filteredData:s,checkedSummary:p,isIndeterminate:y,handleAllCheckedChange:V}=Qe(c,d,v),b=E(()=>!w(d.query)&&w(s.value)),D=E(()=>!w(u.default()[0].children)),{checked:i,allChecked:n,query:m}=Pe(d);return l({query:m}),(_,R)=>(g(),C("div",{class:$(e(t).b("panel"))},[T("p",{class:$(e(t).be("panel","header"))},[k(e(de),{modelValue:e(n),"onUpdate:modelValue":A=>Y(n)?n.value=A:null,indeterminate:e(y),"validate-event":!1,onChange:e(V)},{default:P(()=>[ee(N(_.title)+" ",1),T("span",null,N(e(p)),1)]),_:1},8,["modelValue","onUpdate:modelValue","indeterminate","onChange"])],2),T("div",{class:$([e(t).be("panel","body"),e(t).is("with-footer",e(D))])},[_.filterable?(g(),X(e(Fe),{key:0,modelValue:e(m),"onUpdate:modelValue":A=>Y(m)?m.value=A:null,class:$(e(t).be("panel","filter")),size:"default",placeholder:_.placeholder,"prefix-icon":e($e),clearable:"","validate-event":!1},null,8,["modelValue","onUpdate:modelValue","class","placeholder","prefix-icon"])):z("v-if",!0),te(k(e(we),{modelValue:e(i),"onUpdate:modelValue":A=>Y(i)?i.value=A:null,"validate-event":!1,class:$([e(t).is("filterable",_.filterable),e(t).be("panel","list")])},{default:P(()=>[(g(!0),C(M,null,O(e(s),A=>(g(),X(e(de),{key:A[e(o).key],class:$(e(t).be("panel","item")),value:A[e(o).key],disabled:A[e(o).disabled],"validate-event":!1},{default:P(()=>{var L;return[k(r,{option:(L=_.optionRender)==null?void 0:L.call(_,A)},null,8,["option"])]}),_:2},1032,["class","value","disabled"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","class"]),[[ae,!e(b)&&!e(w)(_.data)]]),te(T("div",{class:$(e(t).be("panel","empty"))},[q(_.$slots,"empty",{},()=>[ee(N(e(b)?e(h)("el.transfer.noMatch"):e(h)("el.transfer.noData")),1)])],2),[[ae,e(b)||e(w)(_.data)]])],2),e(D)?(g(),C("p",{key:0,class:$(e(t).be("panel","footer"))},[q(_.$slots,"default")],2)):z("v-if",!0)],2))}});var ue=fe(Je,[["__file","transfer-panel.vue"]]);const Ye=a=>{const l=W(a),v=E(()=>a.data.reduce((r,h)=>(r[h[l.value.key]]=h)&&r,{})),c=E(()=>a.data.filter(r=>!a.modelValue.includes(r[l.value.key]))),u=E(()=>a.targetOrder==="original"?a.data.filter(r=>a.modelValue.includes(r[l.value.key])):a.modelValue.reduce((r,h)=>{const t=v.value[h];return t&&r.push(t),r},[]));return{sourceData:c,targetData:u}},Ze=(a,l,v)=>{const c=W(a),u=(t,d,o)=>{v(Ce,t),v(ke,t,d,o)};return{addToLeft:()=>{const t=a.modelValue.slice();l.rightChecked.forEach(d=>{const o=t.indexOf(d);o>-1&&t.splice(o,1)}),u(t,"left",l.rightChecked)},addToRight:()=>{let t=a.modelValue.slice();const d=a.data.filter(o=>{const s=o[c.value.key];return l.leftChecked.includes(s)&&!a.modelValue.includes(s)}).map(o=>o[c.value.key]);t=a.targetOrder==="unshift"?d.concat(t):t.concat(d),a.targetOrder==="original"&&(t=a.data.filter(o=>t.includes(o[c.value.key])).map(o=>o[c.value.key])),u(t,"right",l.leftChecked)}}},Ie=(a,l)=>({onSourceCheckedChange:(u,r)=>{a.leftChecked=u,r&&l(be,u,r)},onTargetCheckedChange:(u,r)=>{a.rightChecked=u,r&&l(_e,u,r)}}),xe=F({name:"ElTransfer"}),et=F({...xe,props:H,emits:ze,setup(a,{expose:l,emit:v}){const c=a,u=he(),{t:r}=pe(),h=me("transfer"),{formItem:t}=Ue(),d=ve({leftChecked:[],rightChecked:[]}),o=W(c),{sourceData:s,targetData:p}=Ye(c),{onSourceCheckedChange:y,onTargetCheckedChange:V}=Ie(d,v),{addToLeft:b,addToRight:D}=Ze(c,d,v),i=J(),n=J(),m=f=>{switch(f){case"left":i.value.query="";break;case"right":n.value.query="";break}},_=E(()=>c.buttonTexts.length===2),R=E(()=>c.titles[0]||r("el.transfer.titles.0")),A=E(()=>c.titles[1]||r("el.transfer.titles.1")),L=E(()=>c.filterPlaceholder||r("el.transfer.filterPlaceholder"));K(()=>c.modelValue,()=>{var f;c.validateEvent&&((f=t==null?void 0:t.validate)==null||f.call(t,"change").catch(B=>De()))});const U=E(()=>f=>{var B;if(c.renderContent)return c.renderContent(le,f);const G=(((B=u.default)==null?void 0:B.call(u,{option:f}))||[]).filter(Ee=>Ee.type!==Ne);return G.length?G:le("span",f[o.value.label]||f[o.value.key])});return l({clearQuery:m,leftPanel:i,rightPanel:n}),(f,B)=>(g(),C("div",{class:$(e(h).b())},[k(ue,{ref_key:"leftPanel",ref:i,data:e(s),"option-render":e(U),placeholder:e(L),title:e(R),filterable:f.filterable,format:f.format,"filter-method":f.filterMethod,"default-checked":f.leftDefaultChecked,props:c.props,onCheckedChange:e(y)},{empty:P(()=>[q(f.$slots,"left-empty")]),default:P(()=>[q(f.$slots,"left-footer")]),_:3},8,["data","option-render","placeholder","title","filterable","format","filter-method","default-checked","props","onCheckedChange"]),T("div",{class:$(e(h).e("buttons"))},[k(e(oe),{type:"primary",class:$([e(h).e("button"),e(h).is("with-texts",e(_))]),disabled:e(w)(d.rightChecked),onClick:e(b)},{default:P(()=>[k(e(se),null,{default:P(()=>[k(e(Le))]),_:1}),e(ne)(f.buttonTexts[0])?z("v-if",!0):(g(),C("span",{key:0},N(f.buttonTexts[0]),1))]),_:1},8,["class","disabled","onClick"]),k(e(oe),{type:"primary",class:$([e(h).e("button"),e(h).is("with-texts",e(_))]),disabled:e(w)(d.leftChecked),onClick:e(D)},{default:P(()=>[e(ne)(f.buttonTexts[1])?z("v-if",!0):(g(),C("span",{key:0},N(f.buttonTexts[1]),1)),k(e(se),null,{default:P(()=>[k(e(Re))]),_:1})]),_:1},8,["class","disabled","onClick"])],2),k(ue,{ref_key:"rightPanel",ref:n,data:e(p),"option-render":e(U),placeholder:e(L),filterable:f.filterable,format:f.format,"filter-method":f.filterMethod,title:e(A),"default-checked":f.rightDefaultChecked,props:c.props,onCheckedChange:e(V)},{empty:P(()=>[q(f.$slots,"right-empty")]),default:P(()=>[q(f.$slots,"right-footer")]),_:3},8,["data","option-render","placeholder","filterable","format","filter-method","title","default-checked","props","onCheckedChange"])],2))}});var tt=fe(et,[["__file","transfer.vue"]]);const at=Se(tt),lt=F({__name:"SelectPlayers",setup(a){const l=x(),{players:v}=j(l),c=E(()=>v.value.map(h=>({key:h.id,label:`${h.id}`,disabled:!1}))),u=J(v.value.filter(h=>h.absent).map(h=>h.id));function r(h,t,d){for(const o of v.value)d.includes(o.id)&&(o.absent=t==="right");v.value.sort((o,s)=>Number(o.absent)-Number(s.absent))}return(h,t)=>{const d=at;return g(),X(d,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=o=>u.value=o),data:c.value,titles:["忠诚","鸽子"],onChange:r},null,8,["modelValue","data"])}}}),st={class:"grid-container"},nt={class:"grid-row"},rt=["onClick"],ot={class:"grid-row"},ct={class:"grid-row"},dt={class:"grid-row"},ut=F({__name:"PlayersCube",setup(a){const l=x(),v=ye(),c=["#e0e0e0","#409EFF","#67C23A"],{waves:u,cube:r,lock:h}=j(v),{players:t}=j(l),d=E(()=>{var L;const D=(u==null?void 0:u.value.length)??0,i=(t==null?void 0:t.value.length)??0,n=Array(D).fill(0),m=Array(D).fill(0),_=Array(i).fill(0),R=Array(i).fill(0);for(let U=0;U<D;U++)for(let f=0;f<i;f++){const B=t.value[f],G=(L=r.value[B.id])==null?void 0:L[U];G===1&&!B.absent?(n[U]++,_[f]++):G===2&&!B.absent&&(m[U]++,R[f]++)}const A=n.map((U,f)=>12-U-m[f]);return{outputCounts:n,supportCounts:m,emptyCounts:A,playerOutputCounts:_,playerSupportCounts:R}}),o=E(()=>d.value.outputCounts),s=E(()=>d.value.supportCounts),p=E(()=>d.value.emptyCounts),y=E(()=>t.value.map((D,i)=>{var n;return(D.carry??0)-(((n=d.value.playerOutputCounts)==null?void 0:n[i])??0)})),V=E(()=>t.value.map((D,i)=>{var n;return(D.sup??0)-(((n=d.value.playerSupportCounts)==null?void 0:n[i])??0)}));function b(D,i,n){const m=t.value[D];if(m.absent){ce({message:"鸽子不受影响",type:"warning",duration:2e3});return}else if(n){ce({message:"数据已锁定",type:"warning",duration:2e3});return}const _=p.value[i],R=y.value[D],A=V.value[D],L=r.value[m.id][i];_===0&&L===0?alert(`第 ${i+1} 波人满为患！`):R+A===0&&L===0?alert(`${m.id} 角色不足！`):R===0&&A!==0&&L===0||R!==0&&A===0&&L===1?v.changeCubeState(m.id,i,2):v.changeCubeState(m.id,i,1)}return(D,i)=>(g(),C("div",st,[T("div",nt,[i[0]||(i[0]=T("div",{class:"grid-cell header-cell empty-header"},null,-1)),(g(!0),C(M,null,O(e(u).length,n=>(g(),C("div",{key:"header-"+n,class:"grid-cell header-columns",style:re({backgroundColor:e(u)[n-1].difficulty==="Hard"?"rgb(252, 210, 210)":"rgb(159.5, 206.5, 255)"})},N(e(u)[n-1].difficulty)+" "+N(n),5))),128)),i[1]||(i[1]=T("div",{class:"grid-cell info-head"}," 余C ",-1)),i[2]||(i[2]=T("div",{class:"grid-cell info-head"}," 余奶 ",-1)),i[3]||(i[3]=T("div",{class:"grid-cell info-head"}," 余人 ",-1))]),(g(!0),C(M,null,O(e(t),(n,m)=>(g(),C("div",{key:m,class:"grid-row"},[T("div",{class:$(["grid-cell",n.absent?"absent":"header-index"])},N((n==null?void 0:n.id)||"未知玩家"),3),(g(!0),C(M,null,O(e(r)[n.id],(_,R)=>(g(),C("div",{key:R,class:$(["grid-cell",{absent:n.absent}]),style:re({backgroundColor:c[_]}),onClick:A=>b(m,R,e(h))},null,14,rt))),128)),T("div",{class:$(["grid-cell",n.absent?"absent":"carry"])},N(y.value[m]),3),T("div",{class:$(["grid-cell",n.absent?"absent":"support"])},N(V.value[m]),3),T("div",{class:$(["grid-cell",{absent:n.absent,left:y.value[m]+V.value[m]!==0&&!e(t)[m].absent,zeroleft:y.value[m]+V.value[m]===0&&!e(t)[m].absent}])},N(y.value[m]+V.value[m]),3)]))),128)),T("div",ot,[i[4]||(i[4]=T("div",{class:"grid-cell header-index info-head"},"输出",-1)),(g(!0),C(M,null,O(e(u).length,n=>(g(),C("div",{key:"stat1-"+n,class:"grid-cell stat-cell carry"},N(o.value[n-1]),1))),128))]),T("div",ct,[i[5]||(i[5]=T("div",{class:"grid-cell header-index info-head"},"辅助",-1)),(g(!0),C(M,null,O(e(u).length,n=>(g(),C("div",{key:"stat2-"+n,class:"grid-cell stat-cell support"},N(s.value[n-1]),1))),128))]),T("div",dt,[i[6]||(i[6]=T("div",{class:"grid-cell header-index info-head"},"空位",-1)),(g(!0),C(M,null,O(e(u).length,n=>(g(),C("div",{key:"stat3-"+n,class:$(["grid-cell stat-cell",{left:p.value[n-1]!==0,zeroleft:p.value[n-1]===0}])},N(p.value[n-1]),3))),128))])]))}}),it=ge(ut,[["__scopeId","data-v-3d54c009"]]),ft={class:"demo-collapse"},ht={key:0},pt=F({__name:"CharPreview",setup(a){const l=x(),{players:v,table:c}=j(l),u=J([]),r=d=>{console.log("当前展开项:",d)};function h(d){return c.value.filter(o=>o.id===d).sort((o,s)=>s.fame-o.fame)}function t({row:d}){return d.ifsup===1?"row-support":d.ifsup===0?"row-carry":""}return(d,o)=>{const s=Ke,p=Ge,y=qe,V=He;return g(),C("div",ft,[k(V,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=b=>u.value=b),onChange:r},{default:P(()=>[(g(!0),C(M,null,O(e(v),b=>(g(),X(y,{key:b.id,title:b.id,name:String(b.id)},{default:P(()=>[u.value.includes(String(b.id))?(g(),C("div",ht,[k(p,{data:h(b.id),style:{width:"100%"},"row-class-name":t},{default:P(()=>[k(s,{prop:"fame",label:"名望"}),k(s,{prop:"profession",label:"职业"})]),_:2},1032,["data"])])):z("",!0)]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"])])}}}),mt={class:"common-layout"},vt=F({__name:"TeamOverview",setup(a){const l=ye(),{lock:v}=j(l);return(c,u)=>{const r=Be,h=it,t=Oe,d=lt,o=Me;return g(),C("div",mt,[k(o,null,{default:P(()=>[k(r,null,{default:P(()=>[k(pt)]),_:1}),k(o,null,{default:P(()=>[k(t,null,{default:P(()=>[k(h)]),_:1}),k(r,null,{default:P(()=>[k(d)]),_:1})]),_:1})]),_:1})])}}}),_t=ge(vt,[["__scopeId","data-v-fc6c66dc"]]);export{_t as default};
