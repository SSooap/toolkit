import{b as W,aZ as Ee,d as de,a_ as Te,x as U,g as V,Z as Ve,L as w,_ as ie,f as R,ad as fe,H as he,u as pe,an as ve,a as H,aJ as Pe,h as b,o as g,k as P,l as G,p as _,w as A,a3 as ee,U as N,m as e,as as Q,n as $,j as Z,a4 as te,bg as Ae,ah as ae,a1 as M,a2 as O,r as K,D as J,K as $e,ao as le,bh as De,E as se,aj as Ne,a8 as ne,ak as Se,v as Ue,bf as j,t as re,aP as me}from"./index-Th_cAdWg.js";import{u as I,d as ge,f as Le,e as Be,g as Me}from"./WaveStore-FiOnlwoA.js";import{E as Oe}from"./input-LMJDASNI.js";import{U as Ce,C as ke,u as Re,a as oe}from"./tag-CuYfEmop.js";import{d as ce,e as Fe,E as He,a as qe,b as Ke,c as we}from"./table-column-Bc0GwXZp.js";import"./use-form-common-props-e3G0M6by.js";const ye="left-check-change",be="right-check-change",q=de({data:{type:U(Array),default:()=>[]},titles:{type:U(Array),default:()=>[]},buttonTexts:{type:U(Array),default:()=>[]},filterPlaceholder:String,filterMethod:{type:U(Function)},leftDefaultChecked:{type:U(Array),default:()=>[]},rightDefaultChecked:{type:U(Array),default:()=>[]},renderContent:{type:U(Function)},modelValue:{type:U(Array),default:()=>[]},format:{type:U(Object),default:()=>({})},filterable:Boolean,props:{type:U(Object),default:()=>Te({label:"label",key:"key",disabled:"disabled"})},targetOrder:{type:String,values:["original","push","unshift"],default:"original"},validateEvent:{type:Boolean,default:!0}}),X=(a,l)=>[a,l].every(W)||W(a)&&Ee(l),Ge={[ke]:(a,l,m)=>[a,m].every(W)&&["left","right"].includes(l),[Ce]:a=>W(a),[ye]:X,[be]:X},Y="checked-change",je=de({data:q.data,optionRender:{type:U(Function)},placeholder:String,title:String,filterable:Boolean,format:q.format,filterMethod:q.filterMethod,defaultChecked:q.leftDefaultChecked,props:q.props}),ze={[Y]:X},z=a=>{const l={label:"label",key:"key",disabled:"disabled"};return V(()=>({...l,...a.props}))},We=(a,l,m)=>{const r=z(a),u=V(()=>a.data.filter(s=>Ve(a.filterMethod)?a.filterMethod(l.query,s):String(s[r.value.label]||s[r.value.key]).toLowerCase().includes(l.query.toLowerCase()))),n=V(()=>u.value.filter(s=>!s[r.value.disabled])),v=V(()=>{const s=l.checked.length,p=a.data.length,{noChecked:y,hasChecked:C}=a.format;return y&&C?s>0?C.replace(/\${checked}/g,s.toString()).replace(/\${total}/g,p.toString()):y.replace(/\${total}/g,p.toString()):`${s}/${p}`}),t=V(()=>{const s=l.checked.length;return s>0&&s<n.value.length}),o=()=>{const s=n.value.map(p=>p[r.value.key]);l.allChecked=s.length>0&&s.every(p=>l.checked.includes(p))},c=s=>{l.checked=s?n.value.map(p=>p[r.value.key]):[]};return w(()=>l.checked,(s,p)=>{if(o(),l.checkChangeByUser){const y=s.concat(p).filter(C=>!s.includes(C)||!p.includes(C));m(Y,s,y)}else m(Y,s),l.checkChangeByUser=!0}),w(n,()=>{o()}),w(()=>a.data,()=>{const s=[],p=u.value.map(y=>y[r.value.key]);l.checked.forEach(y=>{p.includes(y)&&s.push(y)}),l.checkChangeByUser=!1,l.checked=s}),w(()=>a.defaultChecked,(s,p)=>{if(p&&s.length===p.length&&s.every(D=>p.includes(D)))return;const y=[],C=n.value.map(D=>D[r.value.key]);s.forEach(D=>{C.includes(D)&&y.push(D)}),l.checkChangeByUser=!1,l.checked=y},{immediate:!0}),{filteredData:u,checkableData:n,checkedSummary:v,isIndeterminate:t,updateAllChecked:o,handleAllCheckedChange:c}},Ze=R({name:"ElTransferPanel"}),Je=R({...Ze,props:je,emits:ze,setup(a,{expose:l,emit:m}){const r=a,u=fe(),n=({option:k})=>k,{t:v}=he(),t=pe("transfer"),o=ve({checked:[],allChecked:!1,query:"",checkChangeByUser:!0}),c=z(r),{filteredData:s,checkedSummary:p,isIndeterminate:y,handleAllCheckedChange:C}=We(r,o,m),D=V(()=>!H(o.query)&&H(s.value)),E=V(()=>!H(u.default()[0].children)),{checked:d,allChecked:i,query:h}=Pe(o);return l({query:h}),(k,S)=>(g(),b("div",{class:$(e(t).b("panel"))},[P("p",{class:$(e(t).be("panel","header"))},[_(e(ce),{modelValue:e(i),"onUpdate:modelValue":T=>Q(i)?i.value=T:null,indeterminate:e(y),"validate-event":!1,onChange:e(C)},{default:A(()=>[ee(N(k.title)+" ",1),P("span",null,N(e(p)),1)]),_:1},8,["modelValue","onUpdate:modelValue","indeterminate","onChange"])],2),P("div",{class:$([e(t).be("panel","body"),e(t).is("with-footer",e(E))])},[k.filterable?(g(),Z(e(Oe),{key:0,modelValue:e(h),"onUpdate:modelValue":T=>Q(h)?h.value=T:null,class:$(e(t).be("panel","filter")),size:"default",placeholder:k.placeholder,"prefix-icon":e(Ae),clearable:"","validate-event":!1},null,8,["modelValue","onUpdate:modelValue","class","placeholder","prefix-icon"])):G("v-if",!0),te(_(e(Fe),{modelValue:e(d),"onUpdate:modelValue":T=>Q(d)?d.value=T:null,"validate-event":!1,class:$([e(t).is("filterable",k.filterable),e(t).be("panel","list")])},{default:A(()=>[(g(!0),b(M,null,O(e(s),T=>(g(),Z(e(ce),{key:T[e(c).key],class:$(e(t).be("panel","item")),value:T[e(c).key],disabled:T[e(c).disabled],"validate-event":!1},{default:A(()=>{var B;return[_(n,{option:(B=k.optionRender)==null?void 0:B.call(k,T)},null,8,["option"])]}),_:2},1032,["class","value","disabled"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","class"]),[[ae,!e(D)&&!e(H)(k.data)]]),te(P("div",{class:$(e(t).be("panel","empty"))},[K(k.$slots,"empty",{},()=>[ee(N(e(D)?e(v)("el.transfer.noMatch"):e(v)("el.transfer.noData")),1)])],2),[[ae,e(D)||e(H)(k.data)]])],2),e(E)?(g(),b("p",{key:0,class:$(e(t).be("panel","footer"))},[K(k.$slots,"default")],2)):G("v-if",!0)],2))}});var ue=ie(Je,[["__file","transfer-panel.vue"]]);const Qe=a=>{const l=z(a),m=V(()=>a.data.reduce((n,v)=>(n[v[l.value.key]]=v)&&n,{})),r=V(()=>a.data.filter(n=>!a.modelValue.includes(n[l.value.key]))),u=V(()=>a.targetOrder==="original"?a.data.filter(n=>a.modelValue.includes(n[l.value.key])):a.modelValue.reduce((n,v)=>{const t=m.value[v];return t&&n.push(t),n},[]));return{sourceData:r,targetData:u}},Xe=(a,l,m)=>{const r=z(a),u=(t,o,c)=>{m(Ce,t),m(ke,t,o,c)};return{addToLeft:()=>{const t=a.modelValue.slice();l.rightChecked.forEach(o=>{const c=t.indexOf(o);c>-1&&t.splice(c,1)}),u(t,"left",l.rightChecked)},addToRight:()=>{let t=a.modelValue.slice();const o=a.data.filter(c=>{const s=c[r.value.key];return l.leftChecked.includes(s)&&!a.modelValue.includes(s)}).map(c=>c[r.value.key]);t=a.targetOrder==="unshift"?o.concat(t):t.concat(o),a.targetOrder==="original"&&(t=a.data.filter(c=>t.includes(c[r.value.key])).map(c=>c[r.value.key])),u(t,"right",l.leftChecked)}}},Ye=(a,l)=>({onSourceCheckedChange:(u,n)=>{a.leftChecked=u,n&&l(ye,u,n)},onTargetCheckedChange:(u,n)=>{a.rightChecked=u,n&&l(be,u,n)}}),Ie=R({name:"ElTransfer"}),xe=R({...Ie,props:q,emits:Ge,setup(a,{expose:l,emit:m}){const r=a,u=fe(),{t:n}=he(),v=pe("transfer"),{formItem:t}=Re(),o=ve({leftChecked:[],rightChecked:[]}),c=z(r),{sourceData:s,targetData:p}=Qe(r),{onSourceCheckedChange:y,onTargetCheckedChange:C}=Ye(o,m),{addToLeft:D,addToRight:E}=Xe(r,o,m),d=J(),i=J(),h=f=>{switch(f){case"left":d.value.query="";break;case"right":i.value.query="";break}},k=V(()=>r.buttonTexts.length===2),S=V(()=>r.titles[0]||n("el.transfer.titles.0")),T=V(()=>r.titles[1]||n("el.transfer.titles.1")),B=V(()=>r.filterPlaceholder||n("el.transfer.filterPlaceholder"));w(()=>r.modelValue,()=>{var f;r.validateEvent&&((f=t==null?void 0:t.validate)==null||f.call(t,"change").catch(F=>$e()))});const L=V(()=>f=>{var F;if(r.renderContent)return r.renderContent(le,f);const x=(((F=u.default)==null?void 0:F.call(u,{option:f}))||[]).filter(_e=>_e.type!==De);return x.length?x:le("span",f[c.value.label]||f[c.value.key])});return l({clearQuery:h,leftPanel:d,rightPanel:i}),(f,F)=>(g(),b("div",{class:$(e(v).b())},[_(ue,{ref_key:"leftPanel",ref:d,data:e(s),"option-render":e(L),placeholder:e(B),title:e(S),filterable:f.filterable,format:f.format,"filter-method":f.filterMethod,"default-checked":f.leftDefaultChecked,props:r.props,onCheckedChange:e(y)},{empty:A(()=>[K(f.$slots,"left-empty")]),default:A(()=>[K(f.$slots,"left-footer")]),_:3},8,["data","option-render","placeholder","title","filterable","format","filter-method","default-checked","props","onCheckedChange"]),P("div",{class:$(e(v).e("buttons"))},[_(e(oe),{type:"primary",class:$([e(v).e("button"),e(v).is("with-texts",e(k))]),disabled:e(H)(o.rightChecked),onClick:e(D)},{default:A(()=>[_(e(se),null,{default:A(()=>[_(e(Ne))]),_:1}),e(ne)(f.buttonTexts[0])?G("v-if",!0):(g(),b("span",{key:0},N(f.buttonTexts[0]),1))]),_:1},8,["class","disabled","onClick"]),_(e(oe),{type:"primary",class:$([e(v).e("button"),e(v).is("with-texts",e(k))]),disabled:e(H)(o.leftChecked),onClick:e(E)},{default:A(()=>[e(ne)(f.buttonTexts[1])?G("v-if",!0):(g(),b("span",{key:0},N(f.buttonTexts[1]),1)),_(e(se),null,{default:A(()=>[_(e(Se))]),_:1})]),_:1},8,["class","disabled","onClick"])],2),_(ue,{ref_key:"rightPanel",ref:i,data:e(p),"option-render":e(L),placeholder:e(B),filterable:f.filterable,format:f.format,"filter-method":f.filterMethod,title:e(T),"default-checked":f.rightDefaultChecked,props:r.props,onCheckedChange:e(C)},{empty:A(()=>[K(f.$slots,"right-empty")]),default:A(()=>[K(f.$slots,"right-footer")]),_:3},8,["data","option-render","placeholder","filterable","format","filter-method","title","default-checked","props","onCheckedChange"])],2))}});var et=ie(xe,[["__file","transfer.vue"]]);const tt=Ue(et),at=R({__name:"SelectPlayers",setup(a){const l=I(),{players:m}=j(l),r=V(()=>m.value.map(v=>({key:v.id,label:`${v.id}`,disabled:!1}))),u=J([]);function n(v,t,o){for(const c of m.value)o.includes(c.id)&&(c.absent=t==="right");m.value.sort((c,s)=>Number(c.absent)-Number(s.absent))}return(v,t)=>{const o=tt;return g(),Z(o,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=c=>u.value=c),data:r.value,titles:["忠诚","鸽子"],onChange:n},null,8,["modelValue","data"])}}}),lt={class:"grid-container"},st={class:"grid-row"},nt=["onClick"],rt={class:"grid-row"},ot={class:"grid-row"},ct={class:"grid-row"},ut=R({__name:"PlayersCube",setup(a){const l=I(),m=ge(),r=["#e0e0e0","#409EFF","#67C23A"],{waves:u,cube:n,lock:v}=j(m),{players:t}=j(l),o=V(()=>{var B;const E=(u==null?void 0:u.value.length)??0,d=(t==null?void 0:t.value.length)??0,i=Array(E).fill(0),h=Array(E).fill(0),k=Array(d).fill(0),S=Array(d).fill(0);for(let L=0;L<E;L++)for(let f=0;f<d;f++){const F=(B=n.value[f])==null?void 0:B[L];F===1?(i[L]++,k[f]++):F===2&&(h[L]++,S[f]++)}const T=i.map((L,f)=>12-L-h[f]);return{outputCounts:i,supportCounts:h,emptyCounts:T,playerOutputCounts:k,playerSupportCounts:S}}),c=V(()=>o.value.outputCounts),s=V(()=>o.value.supportCounts),p=V(()=>o.value.emptyCounts),y=V(()=>t.value.map((E,d)=>{var i;return(E.countIfSup0??0)-(((i=o.value.playerOutputCounts)==null?void 0:i[d])??0)})),C=V(()=>t.value.map((E,d)=>{var i;return(E.countIfSup1??0)-(((i=o.value.playerSupportCounts)==null?void 0:i[d])??0)}));function D(E,d,i){if(i||t.value[E].absent){alert("数据已锁定");return}const h=p.value[d],k=y.value[E],S=C.value[E],T=n.value[E][d];h===0&&T===0?alert(`第 ${d+1} 波人满为患！`):k+S===0&&T===0?alert(`${t.value[E].id} 需要努力提升角色了！`):k===0&&S!==0&&T===0||k!==0&&S===0&&T===1?m.changeCubeState(E,d,2):m.changeCubeState(E,d,1)}return(E,d)=>(g(),b("div",lt,[P("div",st,[d[0]||(d[0]=P("div",{class:"grid-cell header-cell empty-header"},null,-1)),(g(!0),b(M,null,O(e(u).length,i=>(g(),b("div",{key:"header-"+i,class:"grid-cell header-columns",style:re({backgroundColor:e(u)[i-1].difficulty==="Hard"?"rgb(252, 210, 210)":"rgb(159.5, 206.5, 255)"})},N(e(u)[i-1].difficulty)+" "+N(i),5))),128)),d[1]||(d[1]=P("div",{class:"grid-cell info-head"}," 余C ",-1)),d[2]||(d[2]=P("div",{class:"grid-cell info-head"}," 余奶 ",-1)),d[3]||(d[3]=P("div",{class:"grid-cell info-head"}," 余人 ",-1))]),(g(!0),b(M,null,O(e(n),(i,h)=>{var k;return g(),b("div",{key:h,class:"grid-row"},[P("div",{class:$(["grid-cell",e(t)[h].absent?"absent":"header-index"])},N(((k=e(t)[h])==null?void 0:k.id)||"未知玩家"),3),(g(!0),b(M,null,O(i,(S,T)=>(g(),b("div",{key:T,class:$(["grid-cell",{absent:e(t)[h].absent}]),style:re({backgroundColor:r[S]}),onClick:B=>D(h,T,e(v))},null,14,nt))),128)),P("div",{class:$(["grid-cell",e(t)[h].absent?"absent":"carry"])},N(y.value[h]),3),P("div",{class:$(["grid-cell",e(t)[h].absent?"absent":"support"])},N(C.value[h]),3),P("div",{class:$(["grid-cell",{absent:e(t)[h].absent,left:y.value[h]+C.value[h]!==0&&!e(t)[h].absent,zeroleft:y.value[h]+C.value[h]===0&&!e(t)[h].absent}])},N(y.value[h]+C.value[h]),3)])}),128)),P("div",rt,[d[4]||(d[4]=P("div",{class:"grid-cell header-index info-head"},"输出",-1)),(g(!0),b(M,null,O(e(u).length,i=>(g(),b("div",{key:"stat1-"+i,class:"grid-cell stat-cell carry"},N(c.value[i-1]),1))),128))]),P("div",ot,[d[5]||(d[5]=P("div",{class:"grid-cell header-index info-head"},"辅助",-1)),(g(!0),b(M,null,O(e(u).length,i=>(g(),b("div",{key:"stat2-"+i,class:"grid-cell stat-cell support"},N(s.value[i-1]),1))),128))]),P("div",ct,[d[6]||(d[6]=P("div",{class:"grid-cell header-index info-head"},"空位",-1)),(g(!0),b(M,null,O(e(u).length,i=>(g(),b("div",{key:"stat3-"+i,class:$(["grid-cell stat-cell",{left:p.value[i-1]!==0,zeroleft:p.value[i-1]===0}])},N(p.value[i-1]),3))),128))])]))}}),dt=me(ut,[["__scopeId","data-v-9c045656"]]),it={class:"demo-collapse"},ft={key:0},ht=R({__name:"CharPreview",setup(a){const l=I(),{players:m,table:r}=j(l),u=J("1"),n=t=>{console.log("当前展开项:",t)};function v(t){return r.value.filter(o=>o.id===t).sort((o,c)=>c.fame-o.fame)}return(t,o)=>{const c=we,s=Ke,p=qe,y=He;return g(),b("div",it,[_(y,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=C=>u.value=C),accordion:"",onChange:n},{default:A(()=>[(g(!0),b(M,null,O(e(m),C=>(g(),Z(p,{key:C.id,title:C.id,name:String(C.id)},{default:A(()=>[u.value.includes(String(C.id))?(g(),b("div",ft,[_(s,{data:v(C.id),style:{width:"100%"}},{default:A(()=>[_(c,{prop:"fame",label:"名望"}),_(c,{prop:"profession",label:"职业"})]),_:2},1032,["data"])])):G("",!0)]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"])])}}}),pt={class:"common-layout"},vt=R({__name:"TeamOverview",setup(a){const l=ge(),{lock:m}=j(l);return(r,u)=>{const n=Le,v=dt,t=Me,o=at,c=Be;return g(),b("div",pt,[_(c,null,{default:A(()=>[_(n,null,{default:A(()=>[_(ht)]),_:1}),_(c,null,{default:A(()=>[_(t,null,{default:A(()=>[_(v)]),_:1}),_(n,null,{default:A(()=>[_(o)]),_:1})]),_:1})]),_:1})])}}}),_t=me(vt,[["__scopeId","data-v-80af6724"]]);export{_t as default};
